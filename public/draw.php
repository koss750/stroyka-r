<?php

$data = '{"plan":{"v":3,"id":"4246738","plan_id":"","walls":{"_4fso9":{"id":"_4fso9","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":90,"p1":{"x":262,"y":130.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_yg3go","z0":"c","z1":"p2"}},"p2":{"x":262,"y":480.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_itudb","z0":"c","z1":"p1"}},"l1":{"x":269.5,"y":138},"l2":{"x":269.5,"y":473},"r1":{"x":254.5,"y":123},"r2":{"x":254.5,"y":488},"l1f":{"x":269.5,"y":138},"l2f":{"x":269.5,"y":473},"r1f":{"x":254.5,"y":123},"r2f":{"x":254.5,"y":488},"p1st":0,"p2st":0,"material":"none","inRoom":0,"area":{"outer":9.04,"inner":9.86},"neighbors":{"_itudb":"","_yg3go":""}},"_itudb":{"id":"_itudb","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":0,"p1":{"x":262,"y":480.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_4fso9","z0":"c","z1":"p2"}},"p2":{"x":602.5,"y":480.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_lvrto","z0":"c","z1":"p1"}},"l1":{"x":269.5,"y":473},"l2":{"x":595,"y":473},"r1":{"x":254.5,"y":488},"r2":{"x":610,"y":488},"l1f":{"x":269.5,"y":473},"l2f":{"x":595,"y":473},"r1f":{"x":254.5,"y":488},"r2f":{"x":597.5,"y":488},"p1st":"in","p2st":0,"material":"none","inRoom":0,"area":{"outer":8.79,"inner":9.26},"neighbors":{"_4fso9":"","_lvrto":"","_0ggbp":"","_9r1up":"","_4q3m4":"","_j6wy0":""}},"_lvrto":{"id":"_lvrto","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":-90,"p1":{"x":602.5,"y":480.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_itudb","z0":"c","z1":"p2"}},"p2":{"x":602.5,"y":130.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_yg3go","z0":"c","z1":"p1"}},"l1":{"x":595,"y":473},"l2":{"x":595,"y":138},"r1":{"x":610,"y":488},"r2":{"x":610,"y":123},"l1f":{"x":595,"y":473},"l2f":{"x":595,"y":138},"r1f":{"x":610,"y":473},"r2f":{"x":610,"y":123},"p1st":"in","p2st":0,"material":"none","inRoom":0,"area":{"outer":9.04,"inner":9.45},"neighbors":{"_itudb":"","_yg3go":"","_0ggbp":"","_a4hh1":""}},"_yg3go":{"id":"_yg3go","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":180,"p1":{"x":602.5,"y":130.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_lvrto","z0":"c","z1":"p2"}},"p2":{"x":262,"y":130.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_4fso9","z0":"c","z1":"p1"}},"l1":{"x":595,"y":138},"l2":{"x":269.5,"y":138},"r1":{"x":610,"y":123},"r2":{"x":254.5,"y":123},"l1f":{"x":595,"y":138},"l2f":{"x":269.5,"y":138},"r1f":{"x":610,"y":123},"r2f":{"x":254.5,"y":123},"p1st":"in","p2st":0,"material":"none","inRoom":0,"area":{"outer":8.79,"inner":9.6},"neighbors":{"_lvrto":"","_4fso9":""}},"_0ggbp":{"id":"_0ggbp","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":0,"p1":{"x":610,"y":480.5,"demount":0,"link":{"ot":"wall","ct":"edge","id":"_lvrto","z0":"r","z1":"p1","pos":"in"}},"p2":{"x":761.5,"y":480.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_9r1up","z0":"c","z1":"p1"}},"l1":{"x":610,"y":473},"l2":{"x":768.999,"y":473},"r1":{"x":610,"y":488},"r2":{"x":754,"y":488},"l1f":{"x":610,"y":473},"l2f":{"x":768.999,"y":473},"r1f":{"x":612.5,"y":488},"r2f":{"x":754,"y":488},"p1st":0,"p2st":0,"material":"none","inRoom":0,"area":{"outer":4.29,"inner":3.82},"neighbors":{"_itudb":"","_lvrto":"","_9r1up":"","_4q3m4":"","_j6wy0":""}},"_9r1up":{"id":"_9r1up","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":90,"p1":{"x":761.5,"y":480.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_0ggbp","z0":"c","z1":"p2"}},"p2":{"x":761.5,"y":588.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_8y6m7","z0":"c","z1":"p1"}},"l1":{"x":769,"y":473},"l2":{"x":769,"y":596},"r1":{"x":754,"y":488},"r2":{"x":754,"y":581},"l1f":{"x":768.999,"y":473},"l2f":{"x":769,"y":596},"r1f":{"x":754,"y":488},"r2f":{"x":754,"y":581},"p1st":"in","p2st":0,"material":"none","inRoom":0,"area":{"outer":3.32,"inner":2.51},"neighbors":{"_0ggbp":"","_itudb":"","_8y6m7":""}},"_8y6m7":{"id":"_8y6m7","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":180,"p1":{"x":761.5,"y":588.5,"demount":0,"link":{"ct":"node","ot":"wall","id":"_9r1up","z0":"c","z1":"p2"}},"p2":{"x":612.5,"y":588.5,"demount":0,"link":{"ot":"wall","ct":"edge","id":"_j6wy0","z0":"l","z1":"c","pos":"in"}},"l1":{"x":769,"y":596},"l2":{"x":612.5,"y":596},"r1":{"x":754,"y":581},"r2":{"x":612.5,"y":581},"l1f":{"x":769,"y":596},"l2f":{"x":612.5,"y":596},"r1f":{"x":754,"y":581},"r2f":{"x":612.5,"y":581},"p1st":"in","p2st":0,"material":"none","inRoom":0,"area":{"outer":4.23,"inner":3.82},"neighbors":{"_9r1up":"","_j6wy0":""}},"_j6wy0":{"id":"_j6wy0","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":90,"p1":{"x":605,"y":488,"demount":0,"link":{"ot":"wall","ct":"edge","id":"_itudb","z0":"r","z1":"c","pos":"in"}},"p2":{"x":605,"y":592,"demount":0},"l1":{"x":612.5,"y":488},"l2":{"x":612.5,"y":592},"r1":{"x":597.5,"y":488},"r2":{"x":597.5,"y":592},"l1f":{"x":612.5,"y":488},"l2f":{"x":612.5,"y":581},"r1f":{"x":597.5,"y":488},"r2f":{"x":597.5,"y":592},"p1st":"out","p2st":0,"material":"none","inRoom":0,"area":{"outer":2.51,"inner":2.81},"neighbors":{"_4q3m4":"","_j6wy0":"","_8y6m7":"","_itudb":"","_lvrto":"","_0ggbp":""}},"_a4hh1":{"id":"_a4hh1","plan":"a","role":"wall","child":0,"archive":0,"demount":0,"depth":15,"height":270,"angle":180,"p1":{"x":595,"y":308,"demount":0,"link":{"ot":"wall","ct":"edge","id":"_lvrto","z0":"l","z1":"c","pos":"in"}},"p2":{"x":430,"y":308,"demount":0},"l1":{"x":595,"y":315.5},"l2":{"x":430,"y":315.5},"r1":{"x":595,"y":300.5},"r2":{"x":430,"y":300.5},"l1f":{"x":595,"y":315.5},"l2f":{"x":430,"y":315.5},"r1f":{"x":595,"y":300.5},"r2f":{"x":430,"y":300.5},"p1st":0,"p2st":0,"material":"none","inRoom":0,"area":{"outer":4.46,"inner":4.46},"neighbors":{"_lvrto":""}}},"rigels":{},"pillars":{},"rooms2":{},"items":{},"led_strips":{},"line_strips":{},"cables":{},"pipes":{},"pipes_conditioner":{},"cables_conditioner":{},"pipes_heat":{},"cables_socket":{},"cables_warm_floor":{},"pipes_warm_floor":{},"stripes_light":{},"comments":{},"rulers":{},"freelines":{},"warm_floors":{},"drawings":[[{"x":254.5,"y":488},{"x":597.5,"y":488},{"x":597.5,"y":592},{"x":612.5,"y":592},{"x":612.5,"y":596},{"x":769,"y":596},{"x":768.9999999999709,"y":473},{"x":610,"y":473},{"x":610,"y":123},{"x":254.5,"y":123}]],"total_height":270,"errors":{"roomRebuild":0,"wallWrongLabel":0,"wallTooShort":0,"wallOverWall":0,"wallNoPointS":0,"wallNoPointE":0},"drawing":{"x_min":255,"x_max":769,"y_min":123,"y_max":596,"cx":512,"cy":359.5,"center":{"x":512,"y":359.5},"tl_point":{"x":255,"y":123},"br_point":{"x":769,"y":596},"width":514,"height":473},"session":31698,"version":101,"log_plan":{"wall1":0,"wall2":0,"items1":0,"items2":0,"break_json":0,"counter_saving_one_session":0},"signals":[],"smeta_water_pipes":{"data":[],"hash_pipes":[],"hash_rooms":[],"hash_waters":[]},"borders_init":[{"l":{"p1":{"x":269.5,"y":138},"p2":{"x":269.5,"y":473}}},{"l":{"p1":{"x":254.5,"y":123},"p2":{"x":254.5,"y":488}}},{"l":{"p1":{"x":269.5,"y":473},"p2":{"x":595,"y":473}}},{"l":{"p1":{"x":254.5,"y":488},"p2":{"x":597.5,"y":488}}},{"l":{"p1":{"x":595,"y":473},"p2":{"x":595,"y":315.5}}},{"l":{"p1":{"x":595,"y":300.5},"p2":{"x":595,"y":138}}},{"l":{"p1":{"x":610,"y":473},"p2":{"x":610,"y":123}}},{"l":{"p1":{"x":595,"y":138},"p2":{"x":269.5,"y":138}}},{"l":{"p1":{"x":610,"y":123},"p2":{"x":254.5,"y":123}}},{"l":{"p1":{"x":610,"y":473},"p2":{"x":768.9999999999709,"y":473}}},{"l":{"p1":{"x":612.5,"y":488},"p2":{"x":754,"y":488}}},{"l":{"p1":{"x":768.9999999999709,"y":473},"p2":{"x":769,"y":596}}},{"l":{"p1":{"x":754,"y":488},"p2":{"x":754,"y":581}}},{"l":{"p1":{"x":769,"y":596},"p2":{"x":612.5,"y":596}}},{"l":{"p1":{"x":754,"y":581},"p2":{"x":612.5,"y":581}}},{"l":{"p1":{"x":612.5,"y":607},"p2":{"x":612.5,"y":581}}},{"l":{"p1":{"x":612.5,"y":488},"p2":{"x":612.5,"y":581}}},{"l":{"p1":{"x":597.5,"y":488},"p2":{"x":597.5,"y":592}}},{"l":{"p1":{"x":612.5,"y":592},"p2":{"x":597.5,"y":592}}},{"l":{"p1":{"x":595,"y":315.5},"p2":{"x":430,"y":315.5}}},{"l":{"p1":{"x":595,"y":300.5},"p2":{"x":430,"y":300.5}}},{"l":{"p1":{"x":430,"y":315.5},"p2":{"x":430,"y":300.5}}}],"final":true,"borders":[]},"visual":""}';  // Insert the JSON string here
$decodedData = json_decode($data, true);

// Function to calculate the distance between two points
function calculateDistance($x1, $y1, $x2, $y2) {
    return sqrt(pow($x2 - $x1, 2) + pow($y2 - $y1, 2));
}

// Extracting walls and their lengths
echo "<p> Стены и их длины</p>";
foreach ($decodedData['plan']['walls'] as $wallId => $wallData) {
    $p1 = $wallData['p1'];
    $p2 = $wallData['p2'];
    $length = calculateDistance($p1['x'], $p1['y'], $p2['x'], $p2['y']);
    echo "<p> Стена номер: {$wallId}, Length: {$length}</p>";
}

// Extracting enclosed spaces and their internal areas
echo "<p>Площади стен:</p>";
foreach ($decodedData['plan']['walls'] as $wallId => $wallData) {
    if (isset($wallData['area']['inner'])) {
        echo "<p>Стена номер: {$wallId}, Площадь стены: {$wallData['area']['inner']}</p>";
    }
}

// Extracting rooms
echo "<p>Помещения:</p>";
$roomCount = 1;
foreach ($decodedData['plan']['drawings'] as $drawing) {
    echo "Room {$roomCount}:\n";
    foreach ($drawing as $point) {
        echo "<p>Точка - X: {$point['x']}, Y: {$point['y']}</p>";
    }
    $roomCount++;
}

?>