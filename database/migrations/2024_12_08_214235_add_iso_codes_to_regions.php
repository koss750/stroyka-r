<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up()
    {
        Schema::table('regions', function (Blueprint $table) {
            $table->string('iso_code', 6)->nullable()->after('code');
        });

        // ISO 3166-2:RU codes mapping
        $isoCodes = [
            '77' => 'RU-MOW', // Москва
            '78' => 'RU-SPE', // Санкт-Петербург
            '01' => 'RU-AD',  // Адыгея
            '02' => 'RU-BA',  // Башкортостан
            '03' => 'RU-BU',  // Бурятия
            '04' => 'RU-AL',  // Алтай
            '05' => 'RU-DA',  // Дагестан
            '06' => 'RU-IN',  // Ингушетия
            '07' => 'RU-KB',  // Кабардино-Балкария
            '08' => 'RU-KL',  // Калмыкия
            '09' => 'RU-KC',  // Карачаево-Черкесия
            '10' => 'RU-KR',  // Карелия
            '11' => 'RU-KO',  // Коми
            '12' => 'RU-ME',  // Марий Эл
            '13' => 'RU-MO',  // Мордовия
            '14' => 'RU-SA',  // Саха (Якутия)
            '15' => 'RU-SE',  // Северная Осетия
            '16' => 'RU-TA',  // Татарстан
            '17' => 'RU-TY',  // Тыва
            '18' => 'RU-UD',  // Удмуртия
            '19' => 'RU-KK',  // Хакасия
            '20' => 'RU-CE',  // Чечня
            '21' => 'RU-CU',  // Чувашия
            '22' => 'RU-ALT', // Алтайский край
            '23' => 'RU-KDA', // Краснодарский край
            '24' => 'RU-KYA', // Красноярский край
            '25' => 'RU-PRI', // Приморский край
            '26' => 'RU-STA', // Ставропольский край
            '27' => 'RU-KHA', // Хабаровский край
            '28' => 'RU-AMU', // Амурская область
            '29' => 'RU-ARK', // Архангельская область
            '30' => 'RU-AST', // Астраханская область
            '31' => 'RU-BEL', // Белгородская область
            '32' => 'RU-BRY', // Брянская область
            '33' => 'RU-VLA', // Владимирская область
            '34' => 'RU-VGG', // Волгоградская область
            '35' => 'RU-VLG', // Вологодская область
            '36' => 'RU-VOR', // Воронежская область
            '37' => 'RU-IVA', // Ивановская область
            '38' => 'RU-IRK', // Иркутская область
            '39' => 'RU-KGD', // Калининградская область
            '40' => 'RU-KLU', // Калужская область
            '41' => 'RU-KAM', // Камчатский край
            '42' => 'RU-KEM', // Кемеровская область
            '43' => 'RU-KIR', // Кировская область
            '44' => 'RU-KOS', // Костромская область
            '45' => 'RU-KGN', // Курганская область
            '46' => 'RU-KRS', // Курская область
            '47' => 'RU-LEN', // Ленинградская область
            '48' => 'RU-LIP', // Липецкая область
            '49' => 'RU-MAG', // Магаданская область
            '50' => 'RU-MOS', // Московская область
            '51' => 'RU-MUR', // Мурманская область
            '52' => 'RU-NIZ', // Нижегородская область
            '53' => 'RU-NGR', // Новгородская область
            '54' => 'RU-NVS', // Новосибирская область
            '55' => 'RU-OMS', // Омская область
            '56' => 'RU-ORE', // Оренбургская область
            '57' => 'RU-ORL', // Орловская область
            '58' => 'RU-PNZ', // Пензенская область
            '59' => 'RU-PER', // Пермский край
            '60' => 'RU-PSK', // Псковская область
            '61' => 'RU-ROS', // Ростовская область
            '62' => 'RU-RYA', // Рязанская область
            '63' => 'RU-SAM', // Самарская область
            '64' => 'RU-SAR', // Саратовская область
            '65' => 'RU-SAK', // Сахалинская область
            '66' => 'RU-SVE', // Свердловская область
            '67' => 'RU-SMO', // Смоленская область
            '68' => 'RU-TAM', // Тамбовская область
            '69' => 'RU-TVE', // Тверская область
            '70' => 'RU-TOM', // Томская область
            '71' => 'RU-TUL', // Тульская область
            '72' => 'RU-TYU', // Тюменская область
            '73' => 'RU-ULY', // Ульяновская область
            '74' => 'RU-CHE', // Челябинская область
            '75' => 'RU-ZAB', // Забайкальский край
            '76' => 'RU-YAR', // Ярославская область
            '79' => 'RU-YEV', // Еврейская автономная область
            '83' => 'RU-NEN', // Ненецкий автономный округ
            '86' => 'RU-KHM', // Ханты-Мансийский автономный округ
            '87' => 'RU-CHU', // Чукотский автономный округ
            '89' => 'RU-YAN', // Ямало-Ненецкий автономный округ
            '91' => 'RU-CR',  // Крым
            '92' => 'RU-SEV', // Севастополь
            '93' => 'UA-14',  // ДНР (Donetsk historical ISO code)
            '94' => 'UA-09',  // ЛНР (Luhansk historical ISO code)
            '95' => 'UA-23',  // Запорожская область (Zaporizhzhia historical ISO code)
            '96' => 'UA-65',  // Херсонская область (Kherson historical ISO code)
        ];

        foreach ($isoCodes as $code => $isoCode) {
            DB::table('regions')
                ->where('code', $code)
                ->update(['iso_code' => $isoCode]);
        }
    }

    public function down()
    {
        Schema::table('regions', function (Blueprint $table) {
            $table->dropColumn('iso_code');
        });
    }
};
